# simple 1-key USB keyboard using an attiny85 mcu

Based on Digistump's Digispark attiny85 design & firmware. Runs Arduino code. 

Kinda flakey USB connection, probably because the attiny85 doesn't have a real clock. Firmware uses V-USB. 

Arduino sketch is super-basic.

Board is designed for mechanical keyswitches (MX Cherry). PCB is round, 26mm in diameter (fits in a beer bottle-cap). Getting the PCB made with components comes to about $3/board (when ordering 5 at JLCPCB; you add the micro-USB port though). 

## Programming

1. Download & install things

1.a. The micronucleus firmware (https://github.com/micronucleus/micronucleus)

git clone https://github.com/micronucleus/micronucleus.git

You can use the pre-compiled releases directly, no need to install or make anything for Micronucleus. You could also just download the t85_aggressive.hex file directly. 

1.b. avrdude

sudo apt-get update
sudo apt-get install avrdude

2. Set up your ISP programmer

2.a. Connect PCB to ISP connector on Arduino (or whatever you use to program)

I used a pogo-pin connector, you could try something similar or just hold the board to a bunch of pins. It's flakey without a good connection, but you only need to burn the bootloader once. For the Arduino ISP sketch you can either connect the ICSP header pins (without pin 5 - reset) to the PCB or use pins 10-13 + 5v + GND separately. 

2.b. Test the ICSP connection (optional)

It's flakey. At least make sure you can use it. I used https://github.com/nickgammon/arduino_sketches/tree/master/Atmega_Board_Detector to check.

Output:

22:48:23.561 -> 
22:48:23.561 -> Atmega chip detector.
22:48:23.561 -> Written by Nick Gammon.
22:48:23.561 -> Version 1.20
22:48:23.561 -> Compiled on Nov 27 2020 at 22:47:07 with Arduino IDE 10813.
22:48:23.561 -> Attempting to enter ICSP programming mode ...
22:48:23.694 -> Entered programming mode OK.
22:48:23.694 -> Signature = 0x1E 0x93 0x0B 
22:48:23.694 -> Processor = ATtiny85
22:48:23.694 -> Flash memory size = 8192 bytes.
22:48:23.694 -> LFuse = 0x62 
22:48:23.694 -> HFuse = 0xDF 
22:48:23.694 -> EFuse = 0xFF 
22:48:23.694 -> Lock byte = 0xFF 
22:48:23.694 -> Clock calibration = 0xA8 
22:48:23.727 -> No bootloader support.
22:48:23.727 -> 
22:48:23.727 -> First 256 bytes of program memory:
22:48:23.727 -> 
22:48:23.727 -> 00: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.727 -> 10: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.727 -> 20: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.760 -> 30: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.760 -> 40: 0xFF 0xFE 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.760 -> 50: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.760 -> 60: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.760 -> 70: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.793 -> 80: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.793 -> 90: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.793 -> A0: 0xFF 0xFF 0xFF 0xFF 0xFE 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.793 -> B0: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.793 -> C0: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.826 -> D0: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.826 -> E0: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.826 -> F0: 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 
22:48:23.826 -> 
22:48:23.826 -> Programming mode off.

Note it recognizes the attiny85 MCU.

2.c. Install the ArduinoISP sketch on the Arduino

See https://www.arduino.cc/en/Tutorial/BuiltInExamples/ArduinoISP for more information. See https://www.gammon.com.au/bootloader for more detailed information. 


3. Burn the Micronucleus firmware / bootloader "aggressive" to attiny85 onto the PCB

avrdude -v -P /dev/ttyACM0 -b 19200 -c stk500v1 -p attiny85 -Uflash:w:micronucleus/firmware/releases/t85_aggressive.hex:i -v

(Weirdly, the ArduinoISP sketch needs to be set as stk500v1 in avrdude. Shrug.)

4. Connect PCB to USB directly

5. Install Arduino sketch

6. Retry any step that flakes (it often does)

7. Give up and take a break. Then come back and try it again. Good luck. 

